<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gewichtsanalyse - Durchschnitte V3.04</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        h1 { color: white; font-size: 1.5em; }
        .version { 
            background: rgba(255,255,255,0.2); 
            color: white; 
            padding: 5px 12px; 
            border-radius: 20px; 
            font-size: 0.8em;
        }
        .subtitle { color: rgba(255,255,255,0.7); text-align: center; margin-bottom: 20px; font-size: 0.9em; }
        .card {
            background: rgba(255,255,255,0.95);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .card h2 { color: #1a1a2e; margin-bottom: 15px; font-size: 1.1em; }
        .chart-container { position: relative; height: 350px; }
        
        .toggle-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        .toggle-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            border: 3px solid;
            transition: all 0.2s ease;
            user-select: none;
        }
        .toggle-btn:hover { transform: scale(1.05); }
        .toggle-btn.inactive {
            opacity: 0.35;
            text-decoration: line-through;
        }
        .toggle-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        .toggle-btn[data-day="avg-hafertage"] { border-color: #e91e63; background: rgba(233,30,99,0.15); }
        .toggle-btn[data-day="avg-hafertage"] .toggle-dot { background: #e91e63; }
        .toggle-btn[data-day="avg-rest"] { border-color: #9c27b0; background: rgba(156,39,176,0.15); }
        .toggle-btn[data-day="avg-rest"] .toggle-dot { background: #9c27b0; }
        .toggle-btn[data-day="avg-gesamt"] { border-color: #ff9800; background: rgba(255,152,0,0.15); }
        .toggle-btn[data-day="avg-gesamt"] .toggle-dot { background: #ff9800; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-box {
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            color: white;
        }
        .stat-box.pink { background: linear-gradient(135deg, #e91e63, #f06292); }
        .stat-box.purple { background: linear-gradient(135deg, #9c27b0, #ba68c8); }
        .stat-box.orange { background: linear-gradient(135deg, #ff9800, #ffb74d); }
        .stat-value { font-size: 1.8em; font-weight: bold; }
        .stat-label { font-size: 0.75em; opacity: 0.9; margin-top: 5px; }
        .stat-trend { font-size: 0.85em; margin-top: 8px; padding: 4px 10px; background: rgba(255,255,255,0.2); border-radius: 10px; display: inline-block; }
        
        .trend-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        .trend-table th, .trend-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        .trend-table th { background: #1a1a2e; color: white; }
        .trend-table tr:hover { background: #f8f9fa; }
        .trend-down { color: #28a745; font-weight: bold; }
        .trend-up { color: #dc3545; font-weight: bold; }
        .row-pink { background: rgba(233,30,99,0.1) !important; }
        .row-purple { background: rgba(156,39,176,0.1) !important; }
        .row-orange { background: rgba(255,152,0,0.15) !important; }
        
        .update-info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 10px 15px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
            font-size: 0.9em;
        }
        
        /* Zusammenfassung */
        .summary-card {
            background: linear-gradient(135deg, #1a1a2e, #2d3436);
            color: white;
        }
        .summary-card h2 { color: white; border-bottom: 2px solid rgba(255,255,255,0.2); padding-bottom: 10px; }
        
        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        .summary-section {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
        }
        .summary-section h3 {
            font-size: 0.9em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .summary-section h3 .icon { font-size: 1.2em; }
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.9em;
        }
        .summary-row:last-child { border-bottom: none; }
        .positive { color: #2ecc71; font-weight: bold; }
        .negative { color: #e74c3c; font-weight: bold; }
        .neutral { color: #f39c12; font-weight: bold; }
        
        .comparison-bar {
            margin-top: 20px;
        }
        .comparison-bar h3 {
            font-size: 0.9em;
            margin-bottom: 12px;
        }
        .bar-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        .bar-label {
            width: 120px;
            font-size: 0.8em;
        }
        .bar-container {
            flex: 1;
            height: 24px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        .bar-fill {
            height: 100%;
            border-radius: 12px;
            display: flex;
            align-items: center;
            padding-left: 10px;
            font-size: 0.75em;
            font-weight: bold;
        }
        .bar-pink { background: linear-gradient(90deg, #e91e63, #f06292); }
        .bar-purple { background: linear-gradient(90deg, #9c27b0, #ba68c8); }
        .bar-orange { background: linear-gradient(90deg, #ff9800, #ffb74d); }
        
        .insight-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 12px;
            font-size: 0.9em;
        }
        .insight-box.warning {
            background: rgba(243, 156, 18, 0.2);
            border: 2px solid #f39c12;
        }
        .insight-box.success {
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid #2ecc71;
        }
        .insight-box h4 {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .prognose-box {
            margin-top: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
        }
        .prognose-box h3 { margin-bottom: 12px; font-size: 0.95em; }
        .prognose-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Gewichtsanalyse - Durchschnitte</h1>
            <span class="version">V3.04</span>
        </div>
        <p class="subtitle">Hafertage vs. Rest vs. Gesamt</p>

        <div class="update-info" id="updateInfo"></div>

        <!-- ZUSAMMENFASSUNG -->
        <div class="card summary-card">
            <h2>Zusammenfassung</h2>
            
            <div class="summary-grid">
                <div class="summary-section">
                    <h3><span class="icon">ðŸ“‰</span> Wochentag-Vergleich</h3>
                    <div class="summary-row">
                        <span>Erster Wert</span>
                        <span id="summaryStart">-</span>
                    </div>
                    <div class="summary-row">
                        <span>Aktueller Wert</span>
                        <span id="summaryCurrent">-</span>
                    </div>
                    <div class="summary-row">
                        <span>Veraenderung</span>
                        <span id="summaryChange" class="positive">-</span>
                    </div>
                    <div class="summary-row">
                        <span>Vergleich</span>
                        <span id="summaryDays">-</span>
                    </div>
                </div>
                
                <div class="summary-section">
                    <h3><span class="icon">ðŸ“Š</span> Trends pro Woche</h3>
                    <div class="summary-row">
                        <span>Hafertage (Di+Mi)</span>
                        <span id="summaryTrendH" class="positive">-</span>
                    </div>
                    <div class="summary-row">
                        <span>Rest (Do-Mo)</span>
                        <span id="summaryTrendR" class="neutral">-</span>
                    </div>
                    <div class="summary-row">
                        <span>Gesamt (Mo-So)</span>
                        <span id="summaryTrendG" class="positive">-</span>
                    </div>
                </div>
            </div>
            
            <div class="comparison-bar">
                <h3>Trend-Vergleich (kg/Woche)</h3>
                <div class="bar-row">
                    <span class="bar-label">Hafertage</span>
                    <div class="bar-container">
                        <div class="bar-fill bar-pink" id="barHafertage" style="width: 100%;"></div>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-label">Rest (Do-Mo)</span>
                    <div class="bar-container">
                        <div class="bar-fill bar-purple" id="barRest" style="width: 5%;"></div>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-label">Gesamt</span>
                    <div class="bar-container">
                        <div class="bar-fill bar-orange" id="barGesamt" style="width: 26%;"></div>
                    </div>
                </div>
            </div>
            
            <div class="insight-box warning" id="insightBox">
                <h4>Erkenntnis</h4>
                <p id="insightText">Die Hafertage wirken stark, aber der Rest der Woche (Do-Mo) stagniert fast. Du holst das Defizit unter der Woche wieder auf.</p>
            </div>
            
            <div class="prognose-box">
                <h3>Prognose bei aktuellem Trend</h3>
                <div class="prognose-row">
                    <span>In 4 Wochen</span>
                    <span id="prognose4">-</span>
                </div>
                <div class="prognose-row">
                    <span>In 8 Wochen</span>
                    <span id="prognose8">-</span>
                </div>
                <div class="prognose-row">
                    <span>100 kg erreicht in</span>
                    <span id="prognose100">-</span>
                </div>
            </div>
        </div>

        <!-- Statistik-Boxen -->
        <div class="card">
            <div class="stats-grid">
                <div class="stat-box pink">
                    <div class="stat-value" id="statHafertage">-</div>
                    <div class="stat-label">Durchschnitt Hafertage (Di+Mi)</div>
                    <div class="stat-trend" id="trendHafertage">-</div>
                </div>
                <div class="stat-box purple">
                    <div class="stat-value" id="statRest">-</div>
                    <div class="stat-label">Durchschnitt Rest (Do-Mo)</div>
                    <div class="stat-trend" id="trendRest">-</div>
                </div>
                <div class="stat-box orange">
                    <div class="stat-value" id="statGesamt">-</div>
                    <div class="stat-label">Durchschnitt Gesamt (Mo-So)</div>
                    <div class="stat-trend" id="trendGesamt">-</div>
                </div>
            </div>
        </div>

        <!-- Hauptdiagramm -->
        <div class="card">
            <h2>Wochenverlauf</h2>
            
            <div class="toggle-container">
                <div class="toggle-btn" data-day="avg-hafertage" data-index="0" onclick="toggleDay(this)">
                    <span class="toggle-dot"></span>Durchschnitt Hafertage (Di+Mi)
                </div>
                <div class="toggle-btn" data-day="avg-rest" data-index="1" onclick="toggleDay(this)">
                    <span class="toggle-dot"></span>Durchschnitt Rest (Do-Mo)
                </div>
                <div class="toggle-btn" data-day="avg-gesamt" data-index="2" onclick="toggleDay(this)">
                    <span class="toggle-dot"></span>Durchschnitt Gesamt (Mo-So)
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="avgChart"></canvas>
            </div>
        </div>

        <!-- Wochentage-Diagramm -->
        <div class="card">
            <h2>Wochentage im Vergleich</h2>
            
            <div class="toggle-container">
                <div class="toggle-btn" data-day="mo" data-index="0" onclick="toggleWeekday(this)" style="border-color: #f44336; background: rgba(244,67,54,0.15);">
                    <span class="toggle-dot" style="background: #f44336;"></span>Montag
                </div>
                <div class="toggle-btn" data-day="di" data-index="1" onclick="toggleWeekday(this)" style="border-color: #e91e63; background: rgba(233,30,99,0.15);">
                    <span class="toggle-dot" style="background: #e91e63;"></span>Dienstag
                </div>
                <div class="toggle-btn" data-day="mi" data-index="2" onclick="toggleWeekday(this)" style="border-color: #4caf50; background: rgba(76,175,80,0.15);">
                    <span class="toggle-dot" style="background: #4caf50;"></span>Mittwoch
                </div>
                <div class="toggle-btn" data-day="do" data-index="3" onclick="toggleWeekday(this)" style="border-color: #2196f3; background: rgba(33,150,243,0.15);">
                    <span class="toggle-dot" style="background: #2196f3;"></span>Donnerstag
                </div>
                <div class="toggle-btn" data-day="fr" data-index="4" onclick="toggleWeekday(this)" style="border-color: #9c27b0; background: rgba(156,39,176,0.15);">
                    <span class="toggle-dot" style="background: #9c27b0;"></span>Freitag
                </div>
                <div class="toggle-btn" data-day="sa" data-index="5" onclick="toggleWeekday(this)" style="border-color: #ff9800; background: rgba(255,152,0,0.15);">
                    <span class="toggle-dot" style="background: #ff9800;"></span>Samstag
                </div>
                <div class="toggle-btn" data-day="so" data-index="6" onclick="toggleWeekday(this)" style="border-color: #795548; background: rgba(121,85,72,0.15);">
                    <span class="toggle-dot" style="background: #795548;"></span>Sonntag
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="weekdayChart"></canvas>
            </div>
        </div>

        <!-- Tabelle -->
        <div class="card">
            <h2>Werte pro Woche</h2>
            <table class="trend-table" id="weekTable">
                <thead>
                    <tr>
                        <th>Durchschnitt</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        // =====================================================
        // HIER NUR NEUE WERTE EINTRAGEN - FORMAT: "TT.MM.JJ", gewicht
        // =====================================================
        const rawData = [
            ["28.12.25", 103.2],
            ["29.12.25", 103.4],
            ["30.12.25", 102.7],
            ["31.12.25", 102.7],
            ["01.01.26", 103.2],
            ["02.01.26", 102.5],
            ["03.01.26", 102.5],
            ["04.01.26", 102.9],
            ["05.01.26", 102.8],
            ["06.01.26", 102.5],
            ["07.01.26", 101.8],
            ["08.01.26", 101.9],
            ["09.01.26", 102.1],
            ["10.01.26", 102.4],
            ["11.01.26", 102.5],
            ["12.01.26", 104.1],
            ["13.01.26", 102.4],
            ["14.01.26", 101.6],
            ["15.01.26", 102.5],
            ["16.01.26", 102.4],
            ["17.01.26", 102.5],
            ["18.01.26", 102.7],
            ["19.01.26", 102.8],
            ["20.01.26", 101.4],
            ["21.01.26", 101.9],
            ["22.01.26", 103.4],
            ["23.01.26", 102.7],
            ["24.01.26", 102.9],
            ["25.01.26", 103.0],
            ["26.01.26", 102.8],
            ["27.01.26", 101.6],
            ["28.01.26", 101.7],
            ["29.01.26", 103.0],
            ["30.01.26", 102.4],
            ["31.01.26", 103.7],
            ["01.02.26", 102.9],
            ["02.02.26", 103.1],
            ["03.02.26", 102.4],
            ["04.02.26", 101.3],
            ["05.02.26", 101.6],
            ["06.02.26", 102.1],
            ["07.02.26", 101.5],
            ["08.02.26", 102.5],
            ["09.02.26", 102.6],
            ["10.02.26", 102.1],
            ["11.02.26", 101.5],
            ["12.02.26", 101.8],
            ["13.02.26", 102.4],
            ["14.02.26", 102.9],
            ["15.02.26", 102.9],
            ["16.02.26", 102.0],
            // NEUE WERTE HIER EINFUEGEN
        ];
        // =====================================================

        // Parsen
        function parseData(raw) {
            return raw.map(function(item) {
                var dateStr = item[0];
                var weight = item[1];
                var parts = dateStr.split('.');
                var day = parseInt(parts[0]);
                var month = parseInt(parts[1]);
                var year = parseInt(parts[2]);
                var date = new Date(2000 + year, month - 1, day);
                var weekday = date.getDay();
                return { date: date, dateStr: dateStr, weight: weight, weekday: weekday };
            }).sort(function(a, b) { return a.date - b.date; });
        }

        function assignWeeks(data) {
            var firstMonday = null;
            for (var i = 0; i < data.length; i++) {
                if (data[i].weekday === 1) {
                    firstMonday = data[i];
                    break;
                }
            }
            if (!firstMonday) return data;
            
            var firstMondayTime = firstMonday.date.getTime();
            
            for (var i = 0; i < data.length; i++) {
                var d = data[i];
                var daysSinceFirstMonday = Math.floor((d.date.getTime() - firstMondayTime) / (1000 * 60 * 60 * 24));
                
                if (daysSinceFirstMonday < 0) {
                    d.weekNum = 1;
                } else {
                    d.weekNum = Math.floor(daysSinceFirstMonday / 7) + 2;
                }
            }
            return data;
        }

        function avg(arr) {
            var valid = arr.filter(function(v) { return v !== null && v !== undefined; });
            if (valid.length === 0) return null;
            var sum = 0;
            for (var i = 0; i < valid.length; i++) sum += valid[i];
            return Math.round((sum / valid.length) * 10) / 10;
        }

        function calcTrend(values) {
            var valid = [];
            for (var i = 0; i < values.length; i++) {
                if (values[i] !== null) {
                    valid.push({ x: i, y: values[i] });
                }
            }
            if (valid.length < 2) return 0;
            var n = valid.length;
            var sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
            for (var i = 0; i < valid.length; i++) {
                sumX += valid[i].x;
                sumY += valid[i].y;
                sumXY += valid[i].x * valid[i].y;
                sumXX += valid[i].x * valid[i].x;
            }
            return (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
        }

        var data = parseData(rawData);
        data = assignWeeks(data);
        
        var weeksSet = {};
        for (var i = 0; i < data.length; i++) {
            weeksSet[data[i].weekNum] = true;
        }
        var weeks = Object.keys(weeksSet).map(function(k) { return parseInt(k); }).sort(function(a,b) { return a-b; });

        var weeklyAvg = { hafertage: [], rest: [], gesamt: [] };

        for (var w = 0; w < weeks.length; w++) {
            var week = weeks[w];
            var weekData = data.filter(function(d) { return d.weekNum === week; });
            
            // Hafertage-EFFEKT: Di (2) + Mi (3) messen
            var hafertage = weekData.filter(function(d) { return d.weekday === 2 || d.weekday === 3; }).map(function(d) { return d.weight; });
            // Rest-EFFEKT: Do (4) + Fr (5) + Sa (6) + So (0) + Mo (1)
            var rest = weekData.filter(function(d) { return d.weekday === 0 || d.weekday === 1 || d.weekday >= 4; }).map(function(d) { return d.weight; });
            var gesamt = weekData.map(function(d) { return d.weight; });

            weeklyAvg.hafertage.push(hafertage.length > 0 ? avg(hafertage) : null);
            weeklyAvg.rest.push(rest.length > 0 ? avg(rest) : null);
            weeklyAvg.gesamt.push(gesamt.length > 0 ? avg(gesamt) : null);
        }

        var totalAvgHafertage = avg(weeklyAvg.hafertage.filter(function(v) { return v !== null; }));
        var totalAvgRest = avg(weeklyAvg.rest.filter(function(v) { return v !== null; }));
        var totalAvgGesamt = avg(weeklyAvg.gesamt.filter(function(v) { return v !== null; }));

        var trendHafertage = calcTrend(weeklyAvg.hafertage);
        var trendRest = calcTrend(weeklyAvg.rest);
        var trendGesamt = calcTrend(weeklyAvg.gesamt);

        // UI
        var lastEntry = data[data.length - 1];
        var firstEntry = data[0];
        var wochentage = ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'];
        var daysDiff = Math.floor((lastEntry.date - firstEntry.date) / (1000 * 60 * 60 * 24));
        
        // Ersten Eintrag mit gleichem Wochentag finden
        var firstSameWeekday = null;
        for (var i = 0; i < data.length; i++) {
            if (data[i].weekday === lastEntry.weekday) {
                firstSameWeekday = data[i];
                break;
            }
        }
        var weekdayChange = firstSameWeekday ? lastEntry.weight - firstSameWeekday.weight : null;
        var weeksBetween = firstSameWeekday ? Math.floor((lastEntry.date - firstSameWeekday.date) / (1000 * 60 * 60 * 24 * 7)) : 0;
        
        document.getElementById('updateInfo').innerHTML = 
            'Letzter Eintrag: ' + lastEntry.dateStr + ' (' + wochentage[lastEntry.weekday] + ') = ' + lastEntry.weight + ' kg | Eintraege: ' + data.length;

        document.getElementById('statHafertage').textContent = totalAvgHafertage ? totalAvgHafertage.toFixed(1) : '-';
        document.getElementById('statRest').textContent = totalAvgRest ? totalAvgRest.toFixed(1) : '-';
        document.getElementById('statGesamt').textContent = totalAvgGesamt ? totalAvgGesamt.toFixed(1) : '-';

        function formatTrend(t) { return t >= 0 ? '+' + t.toFixed(2) + ' kg/Wo' : t.toFixed(2) + ' kg/Wo'; }
        document.getElementById('trendHafertage').textContent = formatTrend(trendHafertage);
        document.getElementById('trendRest').textContent = formatTrend(trendRest);
        document.getElementById('trendGesamt').textContent = formatTrend(trendGesamt);

        // Zusammenfassung - Vergleich gleicher Wochentage
        document.getElementById('summaryStart').textContent = firstSameWeekday ? 
            firstSameWeekday.weight + ' kg (' + wochentage[firstSameWeekday.weekday] + ' ' + firstSameWeekday.dateStr + ')' : '-';
        document.getElementById('summaryCurrent').textContent = lastEntry.weight + ' kg (' + wochentage[lastEntry.weekday] + ' ' + lastEntry.dateStr + ')';
        var change = weekdayChange;
        document.getElementById('summaryChange').textContent = change !== null ? 
            ((change >= 0 ? '+' : '') + change.toFixed(1) + ' kg in ' + weeksBetween + ' Wo') : '-';
        document.getElementById('summaryChange').className = change < 0 ? 'positive' : (change > 0 ? 'negative' : 'neutral');
        document.getElementById('summaryDays').textContent = wochentage[lastEntry.weekday] + ' vs. ' + wochentage[lastEntry.weekday];

        document.getElementById('summaryTrendH').textContent = formatTrend(trendHafertage);
        document.getElementById('summaryTrendH').className = trendHafertage < 0 ? 'positive' : 'negative';
        document.getElementById('summaryTrendR').textContent = formatTrend(trendRest);
        document.getElementById('summaryTrendR').className = trendRest < -0.05 ? 'positive' : (trendRest > 0.05 ? 'negative' : 'neutral');
        document.getElementById('summaryTrendG').textContent = formatTrend(trendGesamt);
        document.getElementById('summaryTrendG').className = trendGesamt < 0 ? 'positive' : 'negative';

        // Balken
        var maxTrend = Math.abs(trendHafertage);
        document.getElementById('barHafertage').style.width = '100%';
        document.getElementById('barHafertage').textContent = formatTrend(trendHafertage);
        document.getElementById('barRest').style.width = Math.max(5, Math.abs(trendRest) / maxTrend * 100) + '%';
        document.getElementById('barRest').textContent = formatTrend(trendRest);
        document.getElementById('barGesamt').style.width = Math.max(10, Math.abs(trendGesamt) / maxTrend * 100) + '%';
        document.getElementById('barGesamt').textContent = formatTrend(trendGesamt);

        // Prognose
        var currentWeight = lastEntry.weight;
        document.getElementById('prognose4').textContent = (currentWeight + trendGesamt * 4).toFixed(1) + ' kg';
        document.getElementById('prognose8').textContent = (currentWeight + trendGesamt * 8).toFixed(1) + ' kg';
        var weeksTo100 = (currentWeight - 100) / Math.abs(trendGesamt);
        document.getElementById('prognose100').textContent = trendGesamt < 0 ? Math.ceil(weeksTo100) + ' Wochen' : 'nie (Trend positiv)';

        // Tabelle
        var tableHead = document.querySelector('#weekTable thead tr');
        for (var i = 0; i < weeks.length; i++) {
            var th = document.createElement('th');
            th.textContent = 'Wo ' + weeks[i];
            tableHead.appendChild(th);
        }
        var thTrend = document.createElement('th');
        thTrend.textContent = 'Trend/Wo';
        tableHead.appendChild(thTrend);

        var tableBody = document.querySelector('#weekTable tbody');
        
        function addTableRow(label, values, trend, rowClass) {
            var tr = document.createElement('tr');
            tr.className = rowClass;
            var html = '<td><strong>' + label + '</strong></td>';
            for (var i = 0; i < values.length; i++) {
                html += '<td>' + (values[i] !== null ? values[i].toFixed(1) : '-') + '</td>';
            }
            html += '<td class="' + (trend < 0 ? 'trend-down' : 'trend-up') + '">' + formatTrend(trend) + '</td>';
            tr.innerHTML = html;
            tableBody.appendChild(tr);
        }

        addTableRow('Durchschnitt Hafertage (Di+Mi)', weeklyAvg.hafertage, trendHafertage, 'row-pink');
        addTableRow('Durchschnitt Rest (Do-Mo)', weeklyAvg.rest, trendRest, 'row-purple');
        addTableRow('Durchschnitt Gesamt (Mo-So)', weeklyAvg.gesamt, trendGesamt, 'row-orange');

        // Chart
        var chart = new Chart(document.getElementById('avgChart'), {
            type: 'line',
            data: {
                labels: weeks.map(function(w) { return 'Wo ' + w; }),
                datasets: [
                    {
                        label: 'Durchschnitt Hafertage (Di+Mi)',
                        data: weeklyAvg.hafertage,
                        borderColor: '#e91e63',
                        backgroundColor: 'rgba(233,30,99,0.15)',
                        borderWidth: 4,
                        pointRadius: 10,
                        pointBackgroundColor: '#e91e63',
                        tension: 0.2,
                        fill: true
                    },
                    {
                        label: 'Durchschnitt Rest (Do-Mo)',
                        data: weeklyAvg.rest,
                        borderColor: '#9c27b0',
                        backgroundColor: 'rgba(156,39,176,0.15)',
                        borderWidth: 4,
                        pointRadius: 10,
                        pointBackgroundColor: '#9c27b0',
                        tension: 0.2,
                        fill: true
                    },
                    {
                        label: 'Durchschnitt Gesamt (Mo-So)',
                        data: weeklyAvg.gesamt,
                        borderColor: '#ff9800',
                        backgroundColor: 'rgba(255,152,0,0.2)',
                        borderWidth: 5,
                        pointRadius: 12,
                        pointBackgroundColor: '#ff9800',
                        tension: 0.2,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { 
                    y: { 
                        min: 101,
                        max: 104,
                        title: { display: true, text: 'Gewicht (kg)' }
                    }
                }
            }
        });

        function toggleDay(btn) {
            var index = parseInt(btn.getAttribute('data-index'));
            var isHidden = chart.getDatasetMeta(index).hidden;
            chart.getDatasetMeta(index).hidden = !isHidden;
            if (!isHidden) {
                btn.classList.add('inactive');
            } else {
                btn.classList.remove('inactive');
            }
            chart.update();
        }

        // Wochentage-Chart Daten vorbereiten
        var weekdayData = {
            mo: [], di: [], mi: [], do_: [], fr: [], sa: [], so: []
        };
        var weekdayMap = { 1: 'mo', 2: 'di', 3: 'mi', 4: 'do_', 5: 'fr', 6: 'sa', 0: 'so' };
        
        // FÃ¼r jede Woche den Wert pro Wochentag sammeln
        for (var w = 0; w < weeks.length; w++) {
            var week = weeks[w];
            var weekData = data.filter(function(d) { return d.weekNum === week; });
            
            // Initialisiere mit null
            var moVal = null, diVal = null, miVal = null, doVal = null, frVal = null, saVal = null, soVal = null;
            
            for (var i = 0; i < weekData.length; i++) {
                var d = weekData[i];
                if (d.weekday === 1) moVal = d.weight;
                if (d.weekday === 2) diVal = d.weight;
                if (d.weekday === 3) miVal = d.weight;
                if (d.weekday === 4) doVal = d.weight;
                if (d.weekday === 5) frVal = d.weight;
                if (d.weekday === 6) saVal = d.weight;
                if (d.weekday === 0) soVal = d.weight;
            }
            
            weekdayData.mo.push(moVal);
            weekdayData.di.push(diVal);
            weekdayData.mi.push(miVal);
            weekdayData.do_.push(doVal);
            weekdayData.fr.push(frVal);
            weekdayData.sa.push(saVal);
            weekdayData.so.push(soVal);
        }

        var weekdayChart = new Chart(document.getElementById('weekdayChart'), {
            type: 'line',
            data: {
                labels: weeks.map(function(w) { return 'Wo ' + w; }),
                datasets: [
                    {
                        label: 'Montag',
                        data: weekdayData.mo,
                        borderColor: '#f44336',
                        backgroundColor: 'rgba(244,67,54,0.1)',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointBackgroundColor: '#f44336',
                        tension: 0.2
                    },
                    {
                        label: 'Dienstag',
                        data: weekdayData.di,
                        borderColor: '#e91e63',
                        backgroundColor: 'rgba(233,30,99,0.1)',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointBackgroundColor: '#e91e63',
                        tension: 0.2
                    },
                    {
                        label: 'Mittwoch',
                        data: weekdayData.mi,
                        borderColor: '#4caf50',
                        backgroundColor: 'rgba(76,175,80,0.1)',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointBackgroundColor: '#4caf50',
                        tension: 0.2
                    },
                    {
                        label: 'Donnerstag',
                        data: weekdayData.do_,
                        borderColor: '#2196f3',
                        backgroundColor: 'rgba(33,150,243,0.1)',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointBackgroundColor: '#2196f3',
                        tension: 0.2
                    },
                    {
                        label: 'Freitag',
                        data: weekdayData.fr,
                        borderColor: '#9c27b0',
                        backgroundColor: 'rgba(156,39,176,0.1)',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointBackgroundColor: '#9c27b0',
                        tension: 0.2
                    },
                    {
                        label: 'Samstag',
                        data: weekdayData.sa,
                        borderColor: '#ff9800',
                        backgroundColor: 'rgba(255,152,0,0.1)',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointBackgroundColor: '#ff9800',
                        tension: 0.2
                    },
                    {
                        label: 'Sonntag',
                        data: weekdayData.so,
                        borderColor: '#795548',
                        backgroundColor: 'rgba(121,85,72,0.1)',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointBackgroundColor: '#795548',
                        tension: 0.2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { 
                    y: { 
                        min: 101,
                        max: 105,
                        title: { display: true, text: 'Gewicht (kg)' }
                    }
                }
            }
        });

        function toggleWeekday(btn) {
            var index = parseInt(btn.getAttribute('data-index'));
            var isHidden = weekdayChart.getDatasetMeta(index).hidden;
            weekdayChart.getDatasetMeta(index).hidden = !isHidden;
            if (!isHidden) {
                btn.classList.add('inactive');
            } else {
                btn.classList.remove('inactive');
            }
            weekdayChart.update();
        }
    </script>
</body>
</html>
